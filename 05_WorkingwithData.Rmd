
# Working with existing Data {#exdata}

```{=html}
<script src="https://kit.fontawesome.com/0e67562c4f.js" crossorigin="anonymous"></script>
<!-- <link rel="stylesheet" href="./img/fontawesome.min.css"> -->
```


Please also install the _wobblynameR_ package (only available on GitHub). 
For that you need the _devtools_ package first:

1. `install.packages("devtools")`
2. `devtools::install_github("the-tave/wobblynameR")`

    
## First Steps: Seminar Data

<br>

- Download the data frame from ILIAS and save it in the data subfolder in your R-Project.
- Use the "Import Dataset" Menu under the _Environment_ tab ![Import Dataset](./img/import_dataset.png){height=40px}
    - In that menu, we can select our data file & choose some basic aspects of reading in that data 

<br>

<i class="fa-solid fa-lightbulb" style="color: purple;"></i><i style="color: purple;">Make sure you have the right package installed for reading in specific data types! Here: Please install the readr package with install.packages("readr")</i>



In my experience, it is easiest to work with data where you have an idea of what to expect.
<!-- Therefore, we will all participate in the following study and then use the data throughout the remainder of this course. -->

<!-- [https://exp.wextor.eu/TheTave/PsychResearchR/](https://exp.wextor.eu/TheTave/PsychResearchR/) -->

## Different types of data sources

Data collected from WEXTOR - like from many other sources - will be exported in the CSV format, which stands for comma-separated values.
That means that this type of data has one row per participant and the values for each column (variable) are separated by a _delimiter_ ^[...which often times is a comma, but not always! WEXTOR, for example uses semicolons.].

When our data comes from an Excel file, it will often be exported as CSV because this type of storing data is pretty efficient and uses up very little space on the disk.
A more modern but also more space-consuming way of storing Excel table data is in the XLSX format (Not an acronym, just stands for "Excel Spreadsheet").

Many people use SPSS for statistical analysis and creating dataframes.
These data will be stored in a file with the extension SAV. 
Generally speaking, SAV files are compatible with R.
However, there are some specialties which can cause problems, such as SPSS labels.
We won't go into depth on this, just know that R can sometimes recognize SPSS labelled variables as their own class, in which case the class of those variables should be corrected manually ^[The function calls `as.numeric()` and `as.factor()` will suffice in most cases.].

Finally, of course we can also encounter datafiles that were created in R.
In this case the will have .Rds as the file extension.
A special case of this is when data frames are included in base-R or in a package.
For example, the dataset called `iris` comes with R as an example dataset.

Therefore, we can run a function on it without having to load it at all:

```{r iris}
head(iris)
```

Depending on which type of data we want to work with, there are different ways of loading the data into R.

## Reading in the data

There are two main ways to load data: via the "Import Dataset" menu under the _Environment_-tab or (only) using code and if necessary packages.
In the menu, simply select the option "Import Dataset" menu under the top-right _Environment_-tab and use _From text (readr)_ for csv or other text files (such as .txt).
Note that this menu also offers the possibility to load data from Excel and SPSS.
However, this is much easier done by just using simple commands directly in your script:

Data Source | R command
------|------
WEXTOR (CSV) | `readr::read_delim("data.csv", delim = ";")`
Excel (XLSX) | `xlsx::read.xlsx("data.xlsx", sheetIndex = 1)`
R Data Source (RDS) | `readRDS("data.Rds")`
SPSS (SAV) | `foreign::read.spss("data.sav")`




### Reading in the data
#### Generated Code

<!-- # ```{r include = F} -->
<!-- # edited_data <- PsychResearchR_data[, c(1, 4:8, 12:32)] -->
<!-- # edited_data <- edited_data |> select(-starts_with("vi_")) -->
<!-- # write_csv(edited_data, "data/seminar_data_raw.csv") -->
<!-- # ``` -->



```{r eval = F}
library(readr)
seminar_data_raw <- read_delim("data/seminar_data_raw.csv", 
    delim = ";", escape_double = FALSE, trim_ws = TRUE)
View(seminar_data_raw)
```


### Basic Edits <i class="fa-solid fa-paintbrush" style="color: darkgreen;"></i>



1. Choose an appropriate name, e.g. `raw`
2. Put all _library commands_ at the top of the script so you are ready to conduct all analyses
3. You do not need the _View()_ command in your script
4. If you are not sure about the state of your data, look at it first!
    - View() opens the whole data in new tab; glimpse(), str() and head() give you a rough overview; names() shows you all variable names
5. Some edits are already possible in the menu! Column types can (and sometimes should) be adjusted, e.g. recognizing dates
6. Create a new dataset as a copy in which you do all further edits! E.g. `seminar` with proper varname prefix



### Basic Edits <i class="fa-solid fa-paintbrush" style="color: darkgreen;"></i>
#### Result

```{r warnings = F}
library(readr)
library(wobblynameR)

raw <- read_delim("./data/seminar_data_raw.csv", 
    delim = ",", escape_double = FALSE, 
    col_types = cols(.wx.5.start_date = col_date(format = "%m/%d/%y"),
                     .wx.7.end_date = col_date(format = "%m/%d/%y"), 
                     ...24 = col_skip()),
    trim_ws = TRUE)

# Add "v" as varname prefix to all variables
seminar <- namepref0(raw, "v")
```



## Codebook



- What variables are in the data? -> `names(seminar)`
    - `r names(seminar)`
- What can they tell us? Which analyses might be of interest?



## Descriptives


- In any report, we need to give our readers/ listeners/... an overview of the data
    - We need to know the sample to judge the results!
    - A sample of e.g. 10 female psychology students probably shows different results -generally speaking - than a sample of 10 male soldiers

Name some common descriptives:

- `r fitb(c("mean", "median", "mode", "variance", "standard deviation"), ignore_case = TRUE)`
- `r fitb(c("mean", "median", "mode", "variance", "standard deviation"), ignore_case = TRUE)`
- `r fitb(c("mean", "median", "mode", "variance", "standard deviation"), ignore_case = TRUE)`
- `r fitb(c("mean", "median", "mode", "variance", "standard deviation"), ignore_case = TRUE)`
- `r fitb(c("mean", "median", "mode", "variance", "standard deviation"), ignore_case = TRUE)`

`r hide("Show the solutions")`

- Mean
- Median
- Mode
- Variability, Variance, Standard Deviation
- Data Visualization...

`r unhide()`

### group_by & summarize 


- With the dplyr-workflow, we can easily output group statistics
- Keywords: **group_by()** & **summarize()**
- The code is built like any other dplyr workflow with pipes ( %>% ) in between each:
    1. Define/ name the data frame
    2. group_by(_variable_name_)
    3. in summarize, define a name for the statistic, use a =, use a function like mean() for the measure


<!-- ### Example: group_by & summarize -->

```{r group-by-example}
iris %>% 
  group_by(Species) %>% 
  summarize(m_plength = mean(Petal.Length),
            med_pwidth = median(Petal.Width),
            m_slength = mean(Sepal.Length),
            mode_swidth = getmode(Sepal.Width),
            n = n())
```
    
## Exercises

### group_by & summarize

<br> 
Follow the structure to group the edited seminar data by belief in the soul and output a summary with 

- mean age 
- mean technological skill
- mode music genre 
- median volume of music 
- grouped n (function _n()_)

`r hide("Solution")`

```{r}
seminar %>% 
  group_by(v11_soul) %>% 
  summarize(m_age = mean(v02_age),
            m_tech_skill = mean(v05_skill_tech),
            mode_music = getmode(v07_genre),
            median_volume = median(v08_loudness),
            n = n())
```

`r unhide()`

### Prepare seminar data

We have read in the "seminar_data_raw" and looked at some of the basic edits that we can do easily. 
However, in order to be able to work with the dataset in easily in the future, we should do some more advanced edits.
Specifically, we will:

1. Change the date format so we get a start and end variable including time and date instead of separate date and time variables
2. Remove the unnecessary original date and time variables
3. Change the one missing value in `v12_soul_phil` to "dunno"
4. Rename the ID variable to `ID` & session length variable to `session_length`
5. Make our data type explicit using `as.data.frame()`
6. Save our edited data in an R data set (`Rds`) format so we can use it more easily later!

I suggest using some of the `dplyr` commands that were introduced in the last chapter for edits 1 through 4. 
You can try to figure them out on your own and later look at the solution below.
**I highly recommend you follow along with these steps, as we will use this dataset in later chapters**^[This is very close to real-life practice, but you can also skip it and download the Rds-file from the GitHub repository [here](https://github.com/the-tave/psych_research_in_r/blob/main/data/seminar_data.Rds).]

`r hide("Solution")`

```{r}
seminar <- seminar |> 
  # 1. Change date format 
  mutate(start = as.POSIXct(paste(v.wx.5.start_date, v.wx.4.start_time), format = "%Y-%m-%d %H:%M:%S"),
         end = as.POSIXct(paste(v.wx.7.end_date, v.wx.6.end_time), format = "%Y-%m-%d %H:%M:%S"), 
         .before = v01_gender) %>% # it is more efficient to have date and time together
  # 2. Remove (now) unnecessary original date vars 
  select(-c(v.wx.4.start_time, v.wx.5.start_date, v.wx.6.end_time, v.wx.7.end_date)) %>% 
  # 3. Change missing value to "don't know" - in this case makes sense in context
  mutate(v12_soul_phil = ifelse(is.na(v12_soul_phil), "dunno", v12_soul_phil)) |> 
  # 4. Rename the ID & session length variable
  rename(ID = v.wx.1.id,
         session_length = v.wx.8.session_length)

# 5. Make data type explicit
seminar <- as.data.frame(seminar)

# 6. Save edited data frame in Rds format
saveRDS(seminar, "./data/seminar_data.Rds")
```

`r unhide()`
 
## Wrap-Up & Further Resources {-}
 
<i class="fa-solid fa-anchor" style="color: teal;"></i>
<ul style="color: teal;"> 
<li> Reading in data works with commands like readRDS() but also the "Import Dataset" Menu</li>
<li> Use the menu for WEXTOR data to get an overview and reproducible code</li>
<li> Get/ create a codebook for your data</li>
<li> Always report descriptive data</li>
<li> dplyr's `group_by()` and `summarize()` can output grouped descriptives</li>
</ul>


<br>

<i class="fa-solid fa-book" style="color: orange;"></i>
<ul style="color: orange;">
<li> [Reading in Data in Different Formats](https://www.datafiles.samhsa.gov/get-help/format-specific-issues/how-do-i-read-data-r)</li>
<li> [Stats and R: Descriptives](https://statsandr.com/blog/descriptive-statistics-in-r/) </li>
</ul>

